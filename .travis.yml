language: haskell
ghc: 7.8

cache:
  directories:
    - $HOME/.cabal
    - $HOME/.ghc

install:
  - mkdir -p ~/rust-installer ~/rust
  - curl -sL https://static.rust-lang.org/rustup.sh -o ~/rust-installer/rustup.sh
  - sh ~/rust-installer/rustup.sh --prefix=~/rust --spec=stable -y --disable-sudo 2> /dev/null
  - export PATH=$PATH:$HOME/rust/bin
  - cabal install pandoc

script:
  - make
  - make format
  # Check that make format was executed before submitting.
  - git diff --exit-code

branches:
  only:
    - master

after_success:
  - |
    if [[ "$TRAVIS_PULL_REQUEST" == "false" ]] \
        && [[ "$TRAVIS_BRANCH" == "master" ]]
    then
        mkdir www
        cp rust.css www/
        cp spec.html www/index.html
        ./deploy-gh-pages.sh
    fi
